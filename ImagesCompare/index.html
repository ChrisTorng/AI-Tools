<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高級圖片比較滑動器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .image-compare {
            position: relative;
            width: 100%;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .image-compare img {
            display: block;
            width: 100%;
            height: auto;
        }
        .image-compare .overlay {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 50%;
            overflow: hidden;
        }
        .image-compare .overlay img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: left;
        }
        .slider {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 4px;
            background: white;
            cursor: ew-resize;
        }
        .slider:before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .thumbnails {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .thumbnail {
            width: 18%;
            text-align: center;
            cursor: pointer;
        }
        .thumbnail img {
            width: 100%;
            height: auto;
            margin-bottom: 5px;
        }
        .thumbnail.active {
            border: 2px solid #4CAF50;
        }
        .thumbnail:first-child {
            cursor: default;
            opacity: 0.7;
        }
        #jsonInput {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
        }
        #loadButton {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #loadButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <textarea id="jsonInput" placeholder="輸入 JSON 圖片配置"></textarea>
        <button id="loadButton" onclick="loadImagesFromJson()">載入圖片</button>
        <div class="thumbnails" id="thumbnails"></div>
        <div class="image-compare">
            <img src="/api/placeholder/800/600" alt="比較圖片">
            <div class="overlay">
                <img src="/api/placeholder/800/600" alt="原始圖片">
            </div>
            <div class="slider"></div>
        </div>
    </div>

    <script>
        let images = [];
        const slider = document.querySelector('.slider');
        const overlay = document.querySelector('.overlay');
        const container = document.querySelector('.image-compare');
        const thumbnailsContainer = document.getElementById('thumbnails');
        const compareImg = document.querySelector('.image-compare > img');
        const originalImg = document.querySelector('.overlay img');

        let isDown = false;

        slider.addEventListener('mousedown', () => isDown = true);
        document.addEventListener('mouseup', () => isDown = false);
        document.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            const rect = container.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percent = Math.max(0, Math.min(100, x / rect.width * 100));
            
            overlay.style.width = `${percent}%`;
            slider.style.left = `${percent}%`;
        });

        function loadImagesFromJson() {
            try {
                const json = JSON.parse(document.getElementById('jsonInput').value);
                if (Array.isArray(json) && json.length === 5) {
                    images = json;
                    renderThumbnails();
                    setCompareImage(1);  // 設置第二張圖片作為初始比較圖
                } else {
                    throw new Error('JSON 必須包含恰好 5 張圖片的數組');
                }
            } catch (error) {
                alert('無效的 JSON 格式: ' + error.message);
            }
        }

        function renderThumbnails() {
            thumbnailsContainer.innerHTML = '';
            images.forEach((img, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'thumbnail' + (index === 0 ? ' active' : '');
                thumbnail.innerHTML = `
                    <img src="${img.url}" alt="${img.title}">
                    <div>${img.title}</div>
                `;
                if (index > 0) {
                    thumbnail.onclick = () => setCompareImage(index);
                }
                thumbnailsContainer.appendChild(thumbnail);
            });
            originalImg.src = images[0].url;
        }

        function setCompareImage(index) {
            compareImg.src = images[index].url;
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === 0 || i === index);
            });
        }
    </script>
</body>
</html>